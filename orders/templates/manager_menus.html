<div id="tabs">
	<ul>
		{% for menu in menus %}
			<li><a href="#tabs-{{ forloop.counter }}">{{ menu.title }}</a></li>
		{% endfor %}
	</ul>
	{% for menu in menus %}
		<div id="tabs-{{ forloop.counter }}">
		</div>
	{% endfor %}
</div>

<input type="button" class="button" value="Save" id="save" style="float:left;">


<script type="text/javascript">var menus = new Array();</script>
{% for menu in json_menus %}
	<script type="text/javascript">
		menus['{{ forloop.counter0 }}'] = $.parseJSON('{{ menu|safe }}');
	</script>
{% endfor %}

<script type='text/javascript'>
	$("#save").click(function () {
        var tree = $('.jstree[aria-expanded="true"]').jstree("get_json", -1);
		$.ajax({
			data: {
				'tree': JSON.stringify(tree),
				'csrfmiddlewaretoken': '{{ csrf_token }}'},
			type: "post",
		});
    });
	$(function() {
    $( "#tabs" ).tabs().addClass( "ui-tabs-vertical ui-helper-clearfix" );
    $( "#tabs li" ).removeClass( "ui-corner-top" ).addClass( "ui-corner-left" );
  });
  
  	for (var i=0; i<menus.length; i++){
		var j = i + 1;
		$("#tabs-"+ j +"").jstree({
		"json_data": menus[i],
		"types": {
			"max_depth": 4,
			"valid_children" : ["root"],
			"types": {
				"root" : {
					"valid_children": ["section", "subsection"],
					"icon": {
						"image": "http://static.jstree.com/v.1.0rc/_docs/_drive.png"
					},
					"start_drag" : false,
                    "move_node" : false,
                    "delete_node" : false,
                    "remove" : false
				},
				"section": {
					"valid_children" : ["section", "subsection"]
				},
				"subsection": {
					"valid_children": ["item"]
				},
				"item": {
					"valid_children": "none",
					"icon": {
						"image": "http://static.jstree.com/v.1.0rc/_demo/file.png"
					},
					"rename" : false
				}
			}
		},
		"themes": {
			"theme": "apple"
		},
		"plugins" : [ "themes", "json_data", "ui", "dnd", "crrm", "contextmenu", "hotkeys", "unique", "types" ]
		});
	};
</script>